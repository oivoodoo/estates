<section id="project" ng-controller="ProjectsController" data-project='<%= project_json(@project) %>' data-urls="<%= {follow: follow_project_path(@project), unfollow: unfollow_project_path(@project)}.to_json %>">
  <div class="head">
    <div class="cover">
      <div>
        <div>
          <%= image_tag @project.image.url(:show) %>
        </div>
      </div>
    </div>

    <div class="financials">
      <div>
        <div>
          <div>
            <ul class='size-6'>
              <li class="type"><div><b><%= @project.investment_type %></b> <label>offering</label></div></li>
            </ul>
            <ul class='size-6'>
              <li class="share"><div><b><i>$</i><%= @project.shares %></b> <label>/share</label></div></li>
            </ul>
            <ul class='size-6'>
              <li class="yield"><div><b><%= @project.view_percent %><u></u></b> <label>yield</label></div></li>
            </ul>
            <ul class='size-6'>
              <li class="term"><div><b><%= @project.holding %><u class="short"></u><u class="long"></u></b> <label>term</label></div></li>
            </ul>
            <div class="moneywrap size-3">
              <div>
                <ul class='money'>
                  <li class="raised" style="width:<%= @project.view_percent %>;"><div><label>Raised</label><i>$</i><%= @project.view_raise %></div></li>
                  <li class="budget" style="width:<%= @project.view_remaining_percent %>;"><div><label>Budget</label><i>$</i><%= @project.view_price %></div></li>
                </ul>
                <div class="goal">
                  <div>
                    <div class="goalmeter"><div class="progress " style="width:<%= @project.view_percent %>"><div class="marker" style="left:<%= @project.view_percent %>;"><label><%= @project.view_percent %></label></div></div></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="action">
              <% if user_signed_in? %>
                <button onclick="Turbolinks.visit('<%= new_project_investment_path(@project) %>')">Purchase Shares</button>
              <% else %>
                <a href="<%= new_user_registration_path %>" class="sign-in fancybox.ajax">
                  <button>Purchase Shares</button>
                </a>
                <button style='display: none' onclick="Turbolinks.visit('<%= new_project_investment_path(@project) %>')">Purchase Shares</button>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="title fix">
    <hgroup>
      <h2>
        <div class="trackwrap track">
          <% if user_signed_in? %>
            <button class="track" title="{{followText}}" ng-click="follow()">{{followText}}</button>
          <% else %>
            <a href="<%= new_user_registration_path %>" class="sign-in fancybox.ajax">
              <button>Follow</button>
            </a>
            <button style="display: none;" title="{{followText}}" ng-click="follow()">{{followText}}</button>
          <% end %>
        </div>
        <div class="profile-badge manager-badge">
          <div>
            <a href="<%= dashboard_path %>" title="<%= @project.owner %>"><%= image_tag("cbre.png") %></a>
            <div class="focus"></div>
          </div>
        </div>
        <%= @project.name %>
      </h2>
    </hgroup>

    <div id="tabs" class="tabs major gridwrap-padded">
      <ul>
        <li><a ng-class="{current:projectTab==1}" ng-click="open($event, 'projectTab', 1)"><span>Overview</span></a></li>
        <li><a ng-class="{current:projectTab==2}" ng-click="open($event, 'projectTab', 2)"><span>Financials</span></a></li>
        <% if @project.address? %>
          <li><a ng-class="{current:projectTab==3}" ng-click="open($event, 'projectTab', 3)"><span>Location</span></a></li>
        <% end %>
        <li><a ng-class="{current:projectTab==4}" ng-click="open($event, 'projectTab', 4)"><span>Property</span></a></li>
        <li><a ng-class="{current:projectTab==5}" ng-click="open($event, 'projectTab', 5)"><span>Strengths</span></a></li>
        <li><a ng-class="{current:projectTab==6}" ng-click="open($event, 'projectTab', 6)"><span>Risks</span></a></li>
        <li><a ng-class="{current:projectTab==7}" ng-click="open($event, 'projectTab', 7)"><span>Manager</span></a></li>
      </ul>
    </div>
  </div>

  <div class="body">
    <div class="main">
			<div>
				<div class='tab-content paper' ng-class="{current:projectTab==1}" ng:show="projectTab == 1">
          <%= @project.description.to_s.html_safe %>
				</div>
				<div class='tab-content paper' ng-class="{current:projectTab==2}" ng:show="projectTab == 2">
          <%= @project.financials.to_s.html_safe %>
				</div>
				<div class='tab-content paper'ng-class="{current:projectTab==3}" ng:show="projectTab == 3">
          <div id='map_container' style='display: block'>
            <google-map center="center" latitude="latitude" longitude="longitude" mark-click='true' draggable="true" zoom="zoom" markers="markers" mark-click="true" refresh='projectTab == 3' style="display:block; height: 400px"></google-map>
          </div>
          <div><%= @project.address %></div>
				</div>
				<div class='tab-content paper' ng-class="{current:projectTab==4}" ng:show="projectTab == 4">
          <%= @project.property.to_s.html_safe %>
				</div>
        <div class='tab-content paper' ng-class="{current:projectTab==5}" ng:show="projectTab == 5">
          <%= @project.strength.to_s.html_safe %>
        </div>
        <div class='tab-content paper' ng-class="{current:projectTab==6}" ng:show="projectTab == 6">
          <%= @project.risks.to_s.html_safe %>
        </div>
        <div class='tab-content paper' ng-class="{current:projectTab==7}" ng:show="projectTab == 7">
          <%= @project.manager.to_s.html_safe %>
        </div>
			</div>
    </div>

		<div class="side">
			<div>
        <div class="switch-group">
          <div id="investors-content" class="tab-content side-tab-content side-switch" ng-class="{'side-switch-current':viewerTab==1}">
            <div class="tabs connections-tabs">
              <ul>
                <li><a ng-class="{current:viewerTab==1}" ng:click="open($event, 'viewerTab', 1)" ng:init='viewerTab=1'><em><%= @project.investors.count %></em> Investors</a></li>
                <li><a ng-class="{current:viewerTab==2}" ng:click="open($event, 'viewerTab', 2)"><em><%= @project.followers.count %></em> Followers</a></li>
              </ul>
            </div>

            <ul class="connections" ng-show="viewerTab == 1">
              <%= render partial: 'follower', collection: @project.investors %>
            </ul>
          </div>

          <div id="trackers-content" class="tab-content side-tab-content side-switch" ng-class="{'side-switch-current':viewerTab==2}">
            <div class="tabs connections-tabs">
              <ul>
                <li><a ng-class="{current:viewerTab==1}" ng:click="open($event, 'viewerTab', 1)" ng:init='viewerTab=1'><em><%= @project.investors.count %></em> Investors</a></li>
                <li><a ng-class="{current:viewerTab==2}" ng:click="open($event, 'viewerTab', 2)"><em><%= @project.followers.count %></em> Followers</a></li>
              </ul>
            </div>

            <ul class="connections" id="followed">
              <%= render partial: 'follower', collection: @project.followers %>
            </ul>
          </div>
        </div>
      </div>

      <div id="timeline-content" class="tab-content side-tab-content">
        <ul class="feed">
          <% for activity in @project.activities.order('created_at desc').limit(10) %>
            <%= render_activity(activity) %>
          <% end %>
        </ul>
      </div>
    </div>
  </div>
</section>

