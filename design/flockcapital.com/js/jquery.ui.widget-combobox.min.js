(function(e){e.widget("custom.combobox",{_create:function(){this.wrapper=e("<div>").addClass("custom-combobox").insertAfter(this.element);this.element.hide();this._createAutocomplete();this._createShowAllButton()},_createAutocomplete:function(){var t=this.element.children(":selected"),n=t.val()?t.text():"";this.input=e("<input>").appendTo(this.wrapper).val(n).attr("title","").attr("type","text").attr("placeholder","Country").addClass("custom-combobox-input ui-widget ui-widget-content ui-state-default ui-corner-left").autocomplete({delay:0,minLength:0,source:e.proxy(this,"_source"),position:{my:"left top",at:"left bottom-1"},open:function(t,n){e(".ui-autocomplete").outerWidth(e(t.target).outerWidth(!0))},focus:function(e,t){}}).focus(function(){e(this).data("ui-autocomplete").search(e(this).val())});this._on(this.input,{autocompleteselect:function(e,t){t.item.option.selected=!0;this._trigger("select",e,{item:t.item.option})},autocompletechange:"_removeIfInvalid"})},_createShowAllButton:function(){var t=this.input,n=!1;e("<a>").attr("tabIndex",-1).attr("title","Show All Items").appendTo(this.wrapper).button({icons:{primary:"ui-icon-triangle-1-s"},text:!1}).removeClass("ui-corner-all").addClass("custom-combobox-toggle ui-corner-right").mousedown(function(){n=t.autocomplete("widget").is(":visible")}).click(function(){t.focus();if(n)return;t.autocomplete("search","")})},_source:function(t,n){var r=new RegExp(e.ui.autocomplete.escapeRegex(t.term),"i");n(this.element.children("option").map(function(){var n=e(this).text();if(this.value&&(!t.term||r.test(n)))return{label:n,value:n,option:this}}))},_removeIfInvalid:function(t,n){if(n.item)return;var r=this.input.val(),i=r.toLowerCase(),s=!1;this.element.children("option").each(function(){if(e(this).text().toLowerCase()===i){this.selected=s=!0;return!1}});if(s)return;this.input.val("");this.element.val("");this._delay(function(){this.input.attr("title","")},2500);this.input.data("ui-autocomplete").term=""},_destroy:function(){this.wrapper.remove();this.element.show()}});e.ui.autocomplete.prototype.options.autoSelect=!0;e(document).on("blur",".custom-combobox-input",function(t){var n=e(this),r=e(this).data("ui-autocomplete");r.liveRegion.text("");if(!r.options.autoSelect||r.selectedItem)return;var i=new RegExp("^"+e.ui.autocomplete.escapeRegex(n.val())+"$","i");r.widget().children(".ui-menu-item").each(function(){var t=e(this).data("ui-utocomplete");if(i.test(t)){r.selectedItem=t;return!1}});r.selectedItem&&r._trigger("select",t,{item:r.selectedItem})})})(jQuery);