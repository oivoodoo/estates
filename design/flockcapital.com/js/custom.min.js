window.graphs={};window.gmaps={};jQuery(document).ready(function(e){var t,n,r,s,o,u=parseInt(e("body").css("font-size"),10),a,f,l=!0,c=window.location.protocol+"//"+window.location.host,h=e(window),p=e("body"),d=e("#masthead"),v=e("#wrap"),m=v.find(">footer"),g=e("#nag"),y=p.hasClass("home"),b=p.hasClass("project"),w=p.hasClass("investor"),E=p.hasClass("dashboard"),S=y,x=function(){e(".connections").each(function(t,n){var r=e(n),i=r.find("li").eq(0).height();r.find("li:gt(0)").each(function(t,n){var r=e(n);r.height(i);r.find(".plate").css("text-align","")});r.find("li").css("visibility","visible")})},T=function(){e("#masthead ul ul").each(function(t,n){var r=e(n),i=0;r.children().each(function(t,n){i+=e(n).outerHeight(!0)});r.data("height",i+.5*u)})},N=function(){var n=h.scrollTop();e(".fix").each(function(r,i){var o=e(i),u=o.data("top")||s,a=0;if(n+u+a>o.data("offsetTop")&&t>469){if(!o.data("fixed")){o.addClass("narrow");o.data("fixedclone").insertBefore(o).css("top",u);o.data("fixed",!0);setTimeout(function(){o.data("fixedclone").addClass("narrow")},1)}}else{o.removeClass("narrow").data("fixedclone").removeClass("narrow").detach();o.data("fixed",!1)}})},C=function(n){n.preventDefault();if(b||E){var r=e(".main .tabs a, .tabs.major a").eq(0).attr("href"),i=window.location.hash||r.substring(r.indexOf("#")),o=e(i.replace("#",".")+"-tab"),u=o.closest(".fix, .fixed"),a=u.length?u.data("original")||u.data("fixedclone"):null,f=e("a.tab").not(o),c=e(i+"-content"),h=e(".tab-content").not(c),p=e(".main .tab-content").not(c);if(c.length){if(t>1e3){if(!c.hasClass("side-tab-content")){p.removeClass("current");c.addClass("current");f.removeClass("current");o.addClass("current");if(a.length){var d=a.find(i.replace("#",".")+"-tab").addClass("current"),v=a.find("a.tab").not(d);v.removeClass("current");d.addClass("current")}}}else{h.removeClass("current");c.addClass("current");x();f.removeClass("current");o.addClass("current");if(a.length){var d=a.find(i.replace("#",".")+"-tab").addClass("current"),v=a.find("a.tab").not(d);v.removeClass("current");d.addClass("current")}}l||e("html, body").animate({scrollTop:e(".title.fix").offset().top-s},300)}}if(b){var i=window.location.hash;i=="#location"&&!l&&reLayoutMaps()}if(E){var i=window.location.hash||r.substring(r.indexOf("#"));i=="#reports"&&M();i=="#map"&&!l&&reLayoutMaps()}l=!1},k=function(){t=e(window).width();n=e(window).height();f=m.outerHeight(!0);u=parseInt(p.css("font-size"),10);r=8*u;s=4*u;o=e(".submenu").outerHeight();e(".fix").each(function(t,n){var r=e(n),i=e(".fix").eq(Math.max(1,t)-1);r.data("offsetTop",r.offset().top);r.data("top",t==0?s:s+i.outerHeight())});v.css("padding-bottom",f);b&&t>1e3&&e(".side .tab-content.current").length&&(location.href=e(".main .tabs a, .tabs.major a").eq(0).attr("href"));y&&e("#slideshow").height(function(){return e(this).find(">div").outerHeight()});T();D()};h.on("resize",function(e){k();x();M();reLayoutMaps()}).on("scroll",function(e){D();H();N()}).on("click.nag",function(e){H()}).on("load",function(){k();x();M();for(map_handle in gmaps)gmaps.hasOwnProperty(map_handle)&&init_map(map_handle,gmaps)}).on("hashchange",function(e){C(e)});e(".fix").each(function(t,n){var r=e(n);r.data("fixedclone",r.clone().removeClass("fix").addClass("fixed"));r.data("fixedclone").data("original",r);r.data("fixedclone").find("ul").cleanWhitespace()});e(".main-switch .tabs a").on("click",function(t){var n=e(this),r=n.closest(".switch-group"),i=n.attr("href");if(!n.hasClass("main-switch-current")){r.find(".main-switch").removeClass("main-switch-current");e(i+"-content").addClass("main-switch-current")}});e(".side-switch .tabs a").on("click",function(t){var n=e(this),r=n.closest(".switch-group"),i=n.attr("href");if(!n.hasClass("side-switch-current")){r.find(".side-switch").removeClass("side-switch-current");e(i+"-content").addClass("side-switch-current");x()}});T();e("#masthead li").on("mouseenter",function(t){var n=e(this).find("ul");n.length&&n.height(n.data("height")-1)}).on("mouseleave",function(t){var n=e(this).find("ul");n.length&&n.outerHeight(0)});e(".project-badge .project-name .profile-badge").on("mouseenter",function(t){e(this).parent().find(".manager-location span a").addClass("active")}).on("mouseleave",function(t){e(this).parent().find(".manager-location span a").removeClass("active")});e(".project-badge .profile-badge, .project-badge .action button.follow, .project-badge .action button.tracking, .project-badge .action button.track, .project-badge .manager-location a").on("mouseenter",function(t){e(this).closest(".project-badge").find(".project-thumb .focus, .action button.details").addClass("overridehide");e(this).closest(".project-badge.dash-tracking-list").find(".project-link").addClass("overridehide")}).on("mouseleave",function(t){e(this).closest(".project-badge").find(".project-thumb .focus, .action button.details").removeClass("overridehide");e(this).closest(".project-badge.dash-tracking-list").find(".project-link").removeClass("overridehide")});e("button.tracking.labelled").on("mouseenter",function(t){e(this).text("Stop tracking")}).on("mouseleave",function(t){e(this).text("Tracking")});e(".combobox").combobox();e("#password-old").on("keydown",function(){e(this).prop("type","password")}).on("blur",function(){e(this).val()==""&&e(this).prop("type","text")});e("label.radio").on("click",function(){var t=e(this),n=t.attr("for");if(typeof n!="undefined"){var r=e("#"+n).prop("name");if(typeof r!="undefined"){var i=e('input[name="'+r+'"]');i.each(function(t,n){var r=e(n).attr("id");e("label[for="+r+"]").removeClass("selected")})}}t.addClass("selected")});e("#doc-upload").fileupload({dataType:"json",progressall:function(t,n){var r=parseInt(n.loaded/n.total*100,10);e("#doc-upload-progress .progress").width(r+"%")},done:function(t,n){e("#doc-upload-progress .progress").width("100%");e("#doc-upload-progress").removeClass("error");e("#doc-upload-response").removeClass("error").text("Done!").show()},fail:function(t,n){e("#doc-upload-progress").addClass("error");e("#doc-upload-response").addClass("error").text("Failed!").show()},send:function(t,n){e("#doc-upload-progress").removeClass("error").show();e("#doc-upload-response").hide()}});var L={},A=c+"/g/map_icon.svg";gmap_styles={style_one:[{stylers:[{saturation:-100},{lightness:35}]},{elementType:"labels",stylers:[{weight:.2},{lightness:-10}]},{elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"water",stylers:[{color:"#b8b8b8"}]}]},init_map=function(e,t){if(typeof e=="undefined"||typeof t=="undefined"||!t.hasOwnProperty(e))return!1;var n=document.getElementById(e+"_map_canvas");if(!n)return!1;var r=t[e],s=14,o,u=new google.maps.StyledMapType(gmap_styles.style_one,{name:"Gray Map"}),a="flockStyledMap",f={zoom:s,minZoom:2,scrollwheel:!1,draggable:!0,mapTypeControlOptions:{mapTypeIds:[a,google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.TERRAIN,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID]},backgroundColor:"transparent"},l=new google.maps.Map(n,f),c=new google.maps.MarkerImage(A,null,null,null,new google.maps.Size(18,26));l.infoBubble=new InfoBubble({maxWidth:300,closeButtonClass:"infobubble-close",map:l,content:"",position:new google.maps.LatLng(-35,151),shadowStyle:!1,padding:0,backgroundColor:"white",borderRadius:0,arrowSize:10,borderWidth:0,backgroundClassName:"infobubble",arrowStyle:0,disableAnimation:!0});l.markers=[];var h=new google.maps.LatLngBounds;for(i=0;i<r.length;i++){var p=new google.maps.LatLng(r[i].lat,r[i].lng);h.extend(p);l.markers.push(new google.maps.Marker({map:l,position:p,icon:c,zoomControl:!1,scaleControl:!1,scrollwheel:!1}));google.maps.event.addListener(l.markers[i],"click",function(e,t){return function(){l.markers[t].setZIndex(google.maps.Marker.MAX_ZINDEX+1);l.infoBubble.setContent('<h5><a href="'+r[t].link+'">'+r[t].title+"</a></h5><address>"+r[t].address+"</address>");l.infoBubble.open(l,e)}}(l.markers[i],i))}var d=l.getCenter(),v=function(e){var t=l.getBounds();if(t)if(t.getNorthEast().lat()<85&&t.getSouthWest().lat()>-85)d=l.getCenter();else if(e&&(t.getNorthEast().lat()>85||t.getSouthWest().lat()<-85)){var n=new google.maps.LatLng(85,1e17),r=new google.maps.LatLng(-85,-1e17),i=new google.maps.LatLngBounds(n,r);l.fitBounds(i)}else l.panTo(d)};google.maps.event.addListener(l,"center_changed",v);google.maps.event.addListener(l,"bounds_changed",v);google.maps.event.addListener(l,"zoom_changed",function(){v(!0)});if(r.length>1){o=h.getCenter();l.fitBounds(h);l.setCenter(o)}else{o=new google.maps.LatLng(r[0].lat,r[0].lng);l.setCenter(o)}l.mapTypes.set(a,u);l.setMapTypeId(a);L[e]={center:o,map:l}};reLayoutMaps=function(){for(map_handle in L)if(L.hasOwnProperty(map_handle)){var e=L[map_handle].map,t=L[map_handle].center||e.getCenter();google.maps.event.trigger(e,"resize");e.setZoom(e.getZoom());e.setCenter(t)}};var O={line:{bezierCurve:!1,scaleFontFamily:"neue-haas-grotesk-text",scaleSteps:5,scaleFontColor:"hsl(0, 0%, 97%)",datasetStrokeWidth:1,pointDotRadius:3,pointDotStrokeWidth:1,scaleLineColor:"hsla(0, 0%, 97%, .2)",scaleGridLineColor:"hsla(0, 0%, 97%, .05)",animation:!1,animationEasing:"easeOutQuad",animationSteps:50},doughnut:{segmentStrokeColor:"transparent",animation:!1,animationEasing:"easeOutQuad",animationSteps:50}},M=function(){e.each(window.graphs,function(t,n){var r=e("#"+t+"-canvas");if(r.length&&r.is(":visible")){var i=r.attr("width"),s=r.attr("height");e(".graph-canvas").hide();var o=r.parent().width();e(".graph-canvas").show();r.prop({width:o,height:o*s/i});var u=r.get(0).getContext("2d"),a=e.extend(O[n.type],n.options,{}),f=n.type=="line"?(new Chart(u)).Line(n.data,a):n.type=="doughnut"?(new Chart(u)).Doughnut(n.data,a):null}})};e("#spread").on("click",function(t){var n=d.hasClass("spreaded")?!1:!0;if(!n){d.scrollTop(0).addClass("animating");setTimeout(function(){d.removeClass("animating")},300);e("body").css("overflow","auto")}else e("body").css("overflow","hidden");d.toggleClass("spreaded").height(function(){var e=d.find("nav").outerHeight(!0);mastHeadH=S?n?a+e:a:n?(3+e/u)*1.1+"rem":"3rem";return mastHeadH})});var _,D=function(){if(S){var t=e(window).scrollTop(),n=t>r?!0:!1;if(t<=Math.max(0,e("#intro").height()-r)){document.getElementById("masthead").style.height="";document.getElementById("nav").style.marginTop="";document.getElementById("spread").style.marginTop="";e("#masthead").removeClass("mini")}else if(t>=Math.max(Math.abs(e("#intro").height()-s),0)){document.getElementById("masthead").style.height="";document.getElementById("nav").style.marginTop="";document.getElementById("spread").style.marginTop="";e("#masthead").addClass("mini")}else{a=r-t+Math.max(0,e("#intro").height()-r);document.getElementById("masthead").style.height=a+"px";document.getElementById("nav").style.marginTop=(a-s)/2+"px";document.getElementById("spread").style.marginTop=(a-s)/2+"px";e("#masthead").removeClass("mini")}}},P=!1,H=function(){if(P){setTimeout(function(){g.css("visibility","visible").stop().animate({opacity:1},700)},1e3);e(window).off("click.nag");P=!1}};setTimeout(function(){P=!0},1e3);g.find(".close").on("click",function(e){g.fadeOut(200,function(){g.remove()})});e(".sign-in, .profile-pic").fancybox({helpers:{overlay:{css:{background:"rgba(41,41,41, .9)"}}},closeBtn:!1,afterShow:function(){e(".ext-account-buttons").cleanWhitespace()}});e(".fancybox-video").fancybox({helpers:{overlay:{css:{background:"rgba(41,41,41, .9)"}}},beforeLoad:function(){this.width=parseInt(this.element.data("width"));this.height=parseInt(this.element.data("height"))}});k();h.trigger("hashchange")});jQuery.fn.hasAnyClass=function(){for(var e=0;e<arguments.length;e++)if(this.hasClass(arguments[e]))return!0;return!1};jQuery.fn.cleanWhitespace=function(){textNodes=this.contents().filter(function(){return this.nodeType==3&&!/\S/.test(this.nodeValue)}).remove();return this};,n=t>l?!0:!1;if(t<=Math.max(0,e("#intro").height()-l)){document.getElementById("masthead").style.height="";document.getElementById("nav").style.marginTop="";document.getElementById("spread").style.marginTop="";e("#masthead").removeClass("mini");e("#intro").css("visibility","visible")}else if(t>=Math.max(Math.abs(e("#intro").height()-c),0)){document.getElementById("masthead").style.height="";document.getElementById("nav").style.marginTop="";document.getElementById("spread").style.marginTop="";e("#masthead").addClass("mini");e("#intro").css("visibility","hidden")}else{d=l-t+Math.max(0,e("#intro").height()-l);document.getElementById("masthead").style.height=d+"px";document.getElementById("nav").style.marginTop=(d-c)/2+"px";document.getElementById("spread").style.marginTop=(d-c)/2+"px";e("#masthead").removeClass("mini");e("#intro").css("visibility","visible")}}},B=!1,j=function(){if(B){setTimeout(function(){u.css("visibility","visible").stop().animate({opacity:1},700)},1e3);e(window).off("click.nag");B=!1}};setTimeout(function(){B=auth?!1:!0},1e3);u.find(".close").on("click",function(e){u.fadeOut(200,function(){u.remove()})});var F={helpers:{overlay:{css:{background:"rgba(23,23,23, .9)"}}},closeBtn:!1};e("a.sign-in.sign-up, a.sign-in.forgotten").fancybox(e.extend({},F,{width:650}));e("a.sign-in.log-in").fancybox(F);e(".profile-pic").fancybox(F);e(".fancybox-video").fancybox(e.extend({},F,{beforeLoad:function(){this.width=parseInt(this.element.data("width"));this.height=parseInt(this.element.data("height"))}}));k();t.trigger("hashchange")});jQuery.fn.hasAnyClass=function(){for(var e=0;e<arguments.length;e++)if(this.hasClass(arguments[e]))return!0;return!1};jQuery.fn.cleanWhitespace=function(){textNodes=this.contents().filter(function(){return this.nodeType==3&&!/\S/.test(this.nodeValue)}).remove();return this};