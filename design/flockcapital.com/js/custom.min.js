window.graphs={};window.gmaps={};jQuery(document).ready(function(e){var t,n,r,s,o,u=parseInt(e("body").css("font-size"),10),a,f,l=!0,c=window.location.protocol+"//"+window.location.host,h=e(window),p=e("body"),d=e("#masthead"),v=e("#wrap"),m=v.find(">footer"),g=e("#nag"),y=p.hasClass("home"),b=p.hasClass("project"),w=p.hasClass("investor"),E=p.hasClass("dashboard"),S=p.hasAnyClass("home")?!0:!1,x=function(){e(".connections").each(function(t,n){var r=e(n),i=r.find("li").eq(0).height();r.find("li:gt(0)").each(function(t,n){var r=e(n);r.height(i);r.find(".plate").css("text-align","")});r.find("li").css("visibility","visible")})},T=function(){e("#masthead ul ul").each(function(t,n){var r=e(n),i=0;r.children().each(function(t,n){i+=e(n).outerHeight(!0)});r.data("height",i)})},N=function(){var n=h.scrollTop();e(".fix").each(function(r,i){var o=e(i),u=o.data("top")||s,a=0;if(n+u+a>o.data("offsetTop")&&t>469){if(!o.data("fixed")){o.addClass("narrow");o.data("fixedclone").insertBefore(o).css("top",u);o.data("fixed",!0);setTimeout(function(){o.data("fixedclone").addClass("narrow")},1)}}else{o.removeClass("narrow").data("fixedclone").removeClass("narrow").detach();o.data("fixed",!1)}})},C=function(n){n.preventDefault();if(b||E){var r=e(".main .tabs a, .tabs.major a").eq(0).attr("href"),i=window.location.hash||r.substring(r.indexOf("#")),s=e(i.replace("#",".")+"-tab"),o=s.closest(".tabs"),u=o.data("original")||o.data("fixedclone"),a=e("a.tab").not(s),f=e(i+"-content"),c=e(".tab-content").not(f),h=e(".main .tab-content").not(f);if(f.length)if(t>1e3){if(!f.hasClass("side-tab-content")){h.removeClass("current");f.addClass("current");a.removeClass("current");s.addClass("current");if(u.length){var p=u.find(i.replace("#",".")+"-tab").addClass("current"),d=u.find("a.tab").not(p);d.removeClass("current");p.addClass("current")}}}else{c.removeClass("current");f.addClass("current");x();a.removeClass("current");s.addClass("current");if(u.length){var p=u.find(i.replace("#",".")+"-tab").addClass("current"),d=u.find("a.tab").not(p);d.removeClass("current");p.addClass("current")}}}if(E){var i=window.location.hash||r.substring(r.indexOf("#"));i=="#reports"&&_();i=="#map"&&!l&&reLayoutMaps()}},k=function(){t=e(window).width();n=e(window).height();f=m.outerHeight(!0);u=parseInt(p.css("font-size"),10);r=8*u;s=4*u;o=e(".submenu").outerHeight();e(".fix").each(function(t,n){var r=e(n),i=e(".fix").eq(Math.max(1,t)-1);r.data("offsetTop",r.offset().top);r.data("top",t==0?s:s+i.outerHeight())});v.css("padding-bottom",f);b&&t>1e3&&e(".side .tab-content.current").length&&(location.href=e(".main .tabs a, .tabs.major a").eq(0).attr("href"));T();P()};h.on("resize",function(e){k();x();_();reLayoutMaps()}).on("scroll",function(e){P();B();N()}).on("click.nag",function(e){B()}).on("load",function(){k();x();_();for(map_handle in gmaps)gmaps.hasOwnProperty(map_handle)&&O(map_handle,gmaps)}).on("hashchange",function(e){C(e)});e(".fix").each(function(t,n){var r=e(n);r.data("fixedclone",r.clone().removeClass("fix").addClass("fixed"));r.data("fixedclone").data("original",r);r.data("fixedclone").find("ul").cleanWhitespace()});e(".main-switch .tabs a").on("click",function(t){var n=e(this),r=n.closest(".switch-group"),i=n.attr("href");if(!n.hasClass("main-switch-current")){r.find(".main-switch").removeClass("main-switch-current");e(i+"-content").addClass("main-switch-current")}});e(".side-switch .tabs a").on("click",function(t){var n=e(this),r=n.closest(".switch-group"),i=n.attr("href");if(!n.hasClass("side-switch-current")){r.find(".side-switch").removeClass("side-switch-current");e(i+"-content").addClass("side-switch-current");x()}});T();e("#masthead li").on("mouseenter",function(t){var n=e(this).find("ul");n.length&&n.height(n.data("height")-1)}).on("mouseleave",function(t){var n=e(this).find("ul");n.length&&n.outerHeight(0)});e(".project-badge .project-name .profile-badge").on("mouseenter",function(t){e(this).parent().find(".manager-location span a").addClass("active")}).on("mouseleave",function(t){e(this).parent().find(".manager-location span a").removeClass("active")});e(".project-badge .profile-badge, .project-badge .action button.follow, .project-badge .action button.tracking, .project-badge .action button.track, .project-badge .manager-location a").on("mouseenter",function(t){e(this).closest(".project-badge").find(".project-thumb .focus, .action button.details").addClass("overridehide");e(this).closest(".project-badge.dash-tracking-list").find(".project-link").addClass("overridehide")}).on("mouseleave",function(t){e(this).closest(".project-badge").find(".project-thumb .focus, .action button.details").removeClass("overridehide");e(this).closest(".project-badge.dash-tracking-list").find(".project-link").removeClass("overridehide")});e("button.tracking.labelled").on("mouseenter",function(t){e(this).text("Stop tracking")}).on("mouseleave",function(t){e(this).text("Tracking")});e("#masthead nav ul, .tabs ul, .submenu ul, #intro .action, .financials >div >div >div, .ext-account-buttons").cleanWhitespace();e(".combobox").combobox();e("#password-old").on("keydown",function(){e(this).prop("type","password")}).on("blur",function(){e(this).val()==""&&e(this).prop("type","text")});e("label.radio").on("click",function(){var t=e(this),n=t.attr("for");if(typeof n!="undefined"){var r=e("#"+n).prop("name");if(typeof r!="undefined"){var i=e('input[name="'+r+'"]');i.each(function(t,n){var r=e(n).attr("id");e("label[for="+r+"]").removeClass("selected")})}}t.addClass("selected")});e("#doc-upload").fileupload({dataType:"json",progressall:function(t,n){var r=parseInt(n.loaded/n.total*100,10);e("#doc-upload-progress .progress").width(r+"%")},done:function(t,n){e("#doc-upload-progress .progress").width("100%");e("#doc-upload-progress").removeClass("error");e("#doc-upload-response").removeClass("error").text("Done!").show()},fail:function(t,n){e("#doc-upload-progress").addClass("error");e("#doc-upload-response").addClass("error").text("Failed!").show()},send:function(t,n){e("#doc-upload-progress").removeClass("error").show();e("#doc-upload-response").hide()}});var L={},A={style_one:[{stylers:[{saturation:-100},{lightness:35}]},{elementType:"labels",stylers:[{weight:.2},{lightness:-10}]},{elementType:"labels.text.stroke",stylers:[{visibility:"off"}]},{featureType:"water",stylers:[{color:"#b8b8b8"}]}]},O=function(e,t){if(typeof e=="undefined"||typeof t=="undefined"||!t.hasOwnProperty(e))return!1;var n=document.getElementById(e+"_map_canvas");if(!n)return!1;var r=t[e],s=14,o,u=c+"/g/map_icon@x2.png",a=new google.maps.StyledMapType(A.style_one,{name:"Gray Map"}),f="flockStyledMap",l={zoom:s,minZoom:2,scrollwheel:!1,draggable:!0,mapTypeControlOptions:{mapTypeIds:[f,google.maps.MapTypeId.ROADMAP,google.maps.MapTypeId.TERRAIN,google.maps.MapTypeId.SATELLITE,google.maps.MapTypeId.HYBRID]},backgroundColor:"transparent"},h=new google.maps.Map(n,l),p=new google.maps.MarkerImage(u,null,null,null,new google.maps.Size(18,26));h.infoBubble=new InfoBubble({maxWidth:300,closeButtonClass:"infobubble-close",map:h,content:"",position:new google.maps.LatLng(-35,151),shadowStyle:!1,padding:0,backgroundColor:"white",borderRadius:0,arrowSize:10,borderWidth:0,backgroundClassName:"infobubble",arrowStyle:0,disableAnimation:!0});h.markers=[];var d=new google.maps.LatLngBounds;for(i=0;i<r.length;i++){var v=new google.maps.LatLng(r[i].lat,r[i].lng);d.extend(v);h.markers.push(new google.maps.Marker({map:h,position:v,icon:p,zoomControl:!1,scaleControl:!1,scrollwheel:!1}));google.maps.event.addListener(h.markers[i],"click",function(e,t){return function(){h.markers[t].setZIndex(google.maps.Marker.MAX_ZINDEX+1);h.infoBubble.setContent('<h5><a href="'+r[t].link+'">'+r[t].title+"</a></h5><address>"+r[t].address+"</address>");h.infoBubble.open(h,e)}}(h.markers[i],i))}var m=h.getCenter(),g=function(e){var t=h.getBounds();if(t)if(t.getNorthEast().lat()<85&&t.getSouthWest().lat()>-85)m=h.getCenter();else if(e&&(t.getNorthEast().lat()>85||t.getSouthWest().lat()<-85)){var n=new google.maps.LatLng(85,1e17),r=new google.maps.LatLng(-85,-1e17),i=new google.maps.LatLngBounds(n,r);h.fitBounds(i)}else h.panTo(m)};google.maps.event.addListener(h,"center_changed",g);google.maps.event.addListener(h,"bounds_changed",g);google.maps.event.addListener(h,"zoom_changed",function(){g(!0)});if(r.length>1){o=d.getCenter();h.fitBounds(d);h.setCenter(o)}else{o=new google.maps.LatLng(r[0].lat,r[0].lng);h.setCenter(o)}h.mapTypes.set(f,a);h.setMapTypeId(f);L[e]={center:o,map:h}};reLayoutMaps=function(){for(map_handle in L)if(L.hasOwnProperty(map_handle)){var e=L[map_handle].map,t=L[map_handle].center||e.getCenter();google.maps.event.trigger(e,"resize");e.setZoom(e.getZoom());e.setCenter(t)}};var M={line:{bezierCurve:!1,scaleFontFamily:"neue-haas-grotesk-text",scaleSteps:5,scaleFontColor:"hsl(0, 0%, 97%)",datasetStrokeWidth:1,pointDotRadius:3,pointDotStrokeWidth:1,scaleLineColor:"hsla(0, 0%, 97%, .2)",scaleGridLineColor:"hsla(0, 0%, 97%, .05)",animation:!1,animationEasing:"easeOutQuad",animationSteps:50},doughnut:{segmentStrokeColor:"transparent",animation:!1,animationEasing:"easeOutQuad",animationSteps:50}},_=function(){e.each(window.graphs,function(t,n){var r=e("#"+t+"-canvas");if(r.length&&r.is(":visible")){var i=r.attr("width"),s=r.attr("height");e(".graph-canvas").hide();var o=r.parent().width();e(".graph-canvas").show();r.prop({width:o,height:o*s/i});var u=r.get(0).getContext("2d"),a=e.extend(M[n.type],n.options,{}),f=n.type=="line"?(new Chart(u)).Line(n.data,a):n.type=="doughnut"?(new Chart(u)).Doughnut(n.data,a):null}})};e("#spread").on("click",function(t){var n=d.hasClass("expanded")?!1:!0;if(!n){d.scrollTop(0).addClass("animating");setTimeout(function(){d.removeClass("animating")},300);e("body").css("overflow","auto")}else e("body").css("overflow","hidden");d.toggleClass("expanded").height(function(){var e=d.find("nav").outerHeight(!0);mastHeadH=S?n?a+e:a:n?(3+e/u)*1.1+"rem":"3rem";return mastHeadH})});var D,P=function(){if(S){var t=e(window).scrollTop(),n=t>r?!0:!1;if(t<=Math.max(0,e("#intro").height()-r)){document.getElementById("masthead").style.height="";document.getElementById("nav").style.marginTop="";document.getElementById("expand").style.marginTop="";e("#masthead").removeClass("mini")}else if(t>=Math.max(Math.abs(e("#intro").height()-s),0)){document.getElementById("masthead").style.height="";document.getElementById("nav").style.marginTop="";document.getElementById("expand").style.marginTop="";e("#masthead").addClass("mini")}else{a=r-t+Math.max(0,e("#intro").height()-r);console.log(a);document.getElementById("masthead").style.height=a+"px";document.getElementById("nav").style.marginTop=(a-s)/2+"px";document.getElementById("expand").style.marginTop=(a-s)/2+"px";e("#masthead").removeClass("mini")}}},H=!1,B=function(){if(H){setTimeout(function(){g.css("visibility","visible").stop().animate({opacity:1},700)},1e3);e(window).off("click.nag");H=!1}};setTimeout(function(){H=!1},1e3);g.find(".close").on("click",function(e){g.fadeOut(200,function(){g.remove()})});e(".sign-in, .profile-pic").fancybox({helpers:{overlay:{css:{background:"rgba(41,41,41, .9)"}}},closeBtn:!1,afterShow:function(){e(".ext-account-buttons").cleanWhitespace()}});e(".fancybox-video").fancybox({helpers:{overlay:{css:{background:"rgba(41,41,41, .9)"}}},beforeLoad:function(){this.width=parseInt(this.element.data("width"));this.height=parseInt(this.element.data("height"))}});k();h.trigger("hashchange");l=!1});jQuery.fn.hasAnyClass=function(){for(var e=0;e<arguments.length;e++)if(this.hasClass(arguments[e]))return!0;return!1};jQuery.fn.cleanWhitespace=function(){textNodes=this.contents().filter(function(){return this.nodeType==3&&!/\S/.test(this.nodeValue)}).remove();return this};